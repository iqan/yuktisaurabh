/*!
    photobox v1.9.2
    (c) 2012 Yair Even Or
    LICENSE: GNU AGPLv3
*/

(function(c,y,L){function la(a,b){var c=!1;return function(){c||(a.call(),c=!0,setTimeout(function(){c=!1},b))}}function V(a){if(!document.body.contains(f[0])||a)W&&f.hide(),C.on("touchstart.testMouse",function(){C.off("touchstart.testMouse");P=!0;f.addClass("mobile")}),u.off().on("click",g.toggle),l.off().on("click","a",D.click),v&&f.addClass("msie"),f.off().on("click","img",function(a){a.stopPropagation()}),c(y.body).append(f),E=y.documentElement}function ma(a,b,c){a={transform:"translateX(25%)",
transition:".2s",opacity:0};if(1==b)var k=z;else-1==b&&(a.transform="translateX(-25%)",k=w);k&&(d.css(a),setTimeout(function(){G(k)},200));Q.prop("checked",1==c)}function X(a){var b,c=y.createElement("p").style,f=["ms","O","Moz","Webkit"];if(""==c[a])return a;a=a.charAt(0).toUpperCase()+a.slice(1);for(b=f.length;b--;)if(""==c[f[b]+a])return f[b]+a}function na(a){a=a.keyCode;var b=e.keys;return 0<=c.inArray(a,b.close)&&H()||0<=c.inArray(a,b.next)&&!e.single&&I(w)||0<=c.inArray(a,b.prev)&&!e.single&&
I(z)||!0}function oa(a,b,c){1==c?I(w):-1==c&&I(z)}function Y(){I("pbPrevBtn"==this.id?z:w);return!1}function pa(a){Z=h;h=a;A=m[a][0];z=(h||(e.loop?m.length:0))-1;w=(h+1)%m.length||(e.loop?0:-1)}function I(a){if(!e.loop){var b=0==h&&a==z;if(h==m.length-1&&a==w||b)return}G(a)}function qa(){var a=m[h][0],b=c("<a>").prop("href",m[h][0])[0].search?"&":"?";a+=b+"vq=hd720&wmode=opaque";return c("<iframe>").prop({scrolling:"no",frameborder:0,allowTransparency:!0,src:a}).attr({webkitAllowFullScreen:!0,mozallowfullscreen:!0,
allowFullScreen:!0})}function aa(){M.off("transitionend webkitTransitionEnd oTransitionEnd otransitionend").removeClass("change");if(e.captionTmpl){var a=e.captionTmpl.replace(/{title}/g,m[h][1]).replace(/{currentImageIdx}/g,h+1).replace(/{totalImagesCount}/g,m.length);M.html(a)}}function ra(){f.addClass("error");d[0].src="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==";x.onerror=null}function ba(a){function b(){N.removeAttr("style");clearTimeout(k);f.removeClass("video");
"video"==J?(d.attr("src","data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="),e.off("transitionend webkitTransitionEnd oTransitionEnd otransitionend").css({transition:"none"}),n.addClass("prepare"),f.addClass("video")):d.replaceWith(d=c('<img src="'+A+'" class="prepare">'));setTimeout(function(){f.removeClass("pbHide next prev");d.add(n).removeAttr("style").removeClass("prepare").on("transitionend webkitTransitionEnd oTransitionEnd otransitionend",ca);v&&ca()},50)}
var k=setTimeout(b,2E3);R.fadeOut(300,function(){f.removeClass("pbLoading");R.removeAttr("style")});f.addClass("pbHide");d.add(n).removeClass("zoomable");if(a||"video"!=F[Z].rel)var e=d;else e=n,d.addClass("prepare");if(a||v)b();else e.on("transitionend webkitTransitionEnd oTransitionEnd otransitionend",b)}function ca(){d.add(n).off("transitionend webkitTransitionEnd oTransitionEnd otransitionend").addClass("zoomable");"video"==J?n.removeClass("pbHide"):u&&e.autoplay&&g.play();t&&"function"==typeof t.callback&&
t.callback(F[h])}function sa(a,b){a.preventDefault();a.stopPropagation();var c=t.thumbsList;c.css("height",c[0].clientHeight+10*b);c=S[0].clientHeight/2;N[0].style.cssText="margin-top: -"+c+"px; padding: "+c+"px 0;";l.hide().show(0)}function da(){clearTimeout(g.autoPlayTimer);C.off("mousemove.photobox");x.onload=function(){};x.src=ea.src=fa.src=A}function H(){function a(){""!=f[0].className&&(f.removeClass("show pbHide error pbLoading"),d.removeAttr("class").removeAttr("style").off().data("zoom",
1),d[0].src="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",S.find(".title").empty(),W&&setTimeout(function(){f.hide()},200),e.hideFlash&&c("iframe, object, embed").css("visibility","visible"))}if(!f.hasClass("show"))return!1;da();n.find("iframe").prop("src","").empty();T.prototype.setup();O.clear();f.removeClass("on video").addClass("pbHide");h=-1;d.on("transitionend webkitTransitionEnd oTransitionEnd otransitionend",a);v&&a();setTimeout(function(){t=null},1E3);
setTimeout(a,500);"function"===typeof e.afterClose&&e.afterClose(f)}var t,e,m=[],F,h=-1,A,Z,J,z,w,E,C=c(y),ta=c(L),v=!("placeholder"in y.createElement("input")),W=function(){var a=c("<p>")[0];a.style.cssText="pointer-events:auto";return!a.style.pointerEvents}(),P=!1,B=c();X("transformOrigin");var ua=X("transition"),U=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return window.setTimeout(a,1E3/60)},x={},
ea=new Image,fa=new Image,d,n,ha,ia,Q,S,M,R,u,l,N,ja={single:!1,beforeShow:null,afterClose:null,loop:!0,thumb:null,thumbs:!0,thumbAttr:"data-src",captionTmpl:'<div class="title">{title}</div><div class="counter">({currentImageIdx}/{totalImagesCount})</div>',autoplay:!1,time:3E3,history:!1,hideFlash:!0,zoomable:!0,rotatable:!0,wheelNextPrev:!0,keys:{close:[27,88,67],prev:[37,80],next:[39,78]}},f=c('<div id="pbOverlay">').append(Q=c('<input type="checkbox" id="pbThumbsToggler" checked hidden>'),R=c('<div class="pbLoader"><b></b><b></b><b></b></div>'),
ha=c('<div id="pbPrevBtn" class="prevNext"><b></b></div>').on("click",Y),ia=c('<div id="pbNextBtn" class="prevNext"><b></b></div>').on("click",Y),N=c('<div class="pbWrapper">').append(d=c("<img>"),n=c('<div class="pbVideo">')),c('<div id="pbCloseBtn">').on("click",H)[0],u=c('<div id="pbAutoplayBtn">').append(c('<div class="pbProgress">')),S=c('<div id="pbCaption">').append('<label for="pbThumbsToggler" title="Show/hide thumbnails"></label>','<button title="Rotate right" class="rotateBtn">&#10227;</button>',
M=c('<div class="pbCaptionText">'),l=c("<div>").addClass("pbThumbs")));c.fn.photobox=function(a,b,f){V();return this.each(function(){var e=c(this).data("_photobox");if(e)return"destroy"===a&&e.destroy(),this;"string"!=typeof a&&(a="a");if("prepareDOM"===a)return V(!0),this;b=c.extend({},ja,b||{});t=new T(b,this,a);c(this).data("_photobox",t);t.callback=f})};var T=function(a,b,e){this.options=c.extend({},a);this.target=e;this.selector=c(b||y);this.thumbsList=null;a=this.imageLinksFilter(this.selector.find(e));
this.imageLinks=a[0];this.images=a[1];this.init()};T.prototype={init:function(){this.DOM=this.DOM();this.DOM.rotateBtn.toggleClass("show",this.options.rotatable);this.observerTimeout=null;this.events.binding.call(this)},DOM:function(){var a={};a.scope=f;a.rotateBtn=a.scope.find(".rotateBtn");return a},observeDOM:function(){var a=L.MutationObserver||L.WebKitMutationObserver,b=L.addEventListener;return function(e,f){if(a){var q=this;(new a(function(a,b){(a[0].addedNodes.length||a[0].removedNodes.length)&&
f(q)})).observe(e,{childList:!0,subtree:!0})}else b&&(e.addEventListener("DOMNodeInserted",c.proxy(f,q),!1),e.addEventListener("DOMNodeRemoved",c.proxy(f,q),!1))}}(),open:function(a){var b=c.inArray(a,this.imageLinks);if(-1==b)return!1;e=this.options;m=this.images;F=this.imageLinks;t=this;this.setup(1);f.on("transitionend webkitTransitionEnd oTransitionEnd otransitionend",function(){f.off("transitionend webkitTransitionEnd oTransitionEnd otransitionend").addClass("on");G(b,!0)}).addClass("show");
v&&f.trigger("MSTransitionEnd");return!1},imageLinksFilter:function(a){var b=this,e=[],f,q,d,r;return[a.filter(function(a){a=c(this);var k,ka="";f=a[0].getAttribute("title")||"";b.options.thumb&&(k=a.find(b.options.thumb)[0]);b.options.thumb&&k||(k=a.find("img")[0]);k&&(r=k.getAttribute("data-pb-captionlink"),ka=k.getAttribute(b.options.thumbAttr)||k.getAttribute("src"),f=k.getAttribute("alt")||k.getAttribute("title")||"");r&&(r=r.split("["),2==r.length?(q=r[0],d=r[1].slice(0,-1)):d=q=r,f+=' <a href="'+
d+'">'+q+"</a>");e.push([a[0].href,f,ka]);return!0}),e]},setup:function(a){var b=a?"on":"off";if(e.thumbs&&!P)l[b]("mouseenter.photobox",D.calc)[b]("mousemove.photobox",D.move);a?(d.css({transition:"0s"}).removeAttr("style"),f.show(),l.html(this.thumbsList).trigger("mouseenter.photobox"),e.thumbs?f.addClass("thumbs"):(Q.prop("checked",!1),f.removeClass("thumbs")),2>this.images.length||e.single?f.removeClass("thumbs hasArrows hasCounter hasAutoplay"):(f.addClass("hasArrows hasCounter"),1E3<e.time?
(f.addClass("hasAutoplay"),e.autoplay?g.progress.start():g.pause()):f.removeClass("hasAutoplay")),e.hideFlash&&c("iframe, object, embed").css("visibility","hidden")):ta.off("resize.photobox");C.off("keydown.photobox")[b]({"keydown.photobox":na});P&&(f.removeClass("hasArrows"),N[b]("swipe",ma));if(e.zoomable&&(f[b]({"mousewheel.photobox":c.proxy(this.events.callbacks.onScrollZoom,this)}),!v))l[b]({"mousewheel.photobox":sa});if(!e.single&&e.wheelNextPrev)f[b]({"mousewheel.photobox":la(oa,1E3)})},destroy:function(){e=
this.options;this.selector.off("click.photobox",this.target).removeData("_photobox");H()},events:{binding:function(){var a=this;this.selector.one("mouseenter.photobox",this.target,function(b){a.thumbsList=D.generate.apply(a)});this.selector.on("click.photobox",this.target,function(b){b.preventDefault();a.open(this)});v||1!=this.selector[0].nodeType||this.observeDOM(this.selector[0],c.proxy(this.events.callbacks.onDOMchanges,this));this.DOM.rotateBtn.on("click",this.events.callbacks.onRotateBtnClick)},
callbacks:{onDOMchanges:function(){var a=this;clearTimeout(this.observerTimeout);a.observerTimeout=setTimeout(function(){var b=a.imageLinksFilter(a.selector.find(a.target));if(a.imageLinks.length!=b[0].length){a.imageLinks=b[0];a.images=b[1];if(t&&a.selector==t.selector)for(m=a.images,F=a.imageLinks,b=m.length;b--;);a.thumbsList=D.generate.apply(a);l.html(a.thumbsList);a.images.length&&A&&a.options.thumbs&&(b=a.thumbsList.find('a[href="'+A+'"]').eq(0).parent().index(),-1==b&&(b=0),D.changeActive(b,
0))}},50)},onRotateBtnClick:function(){var a=d.data("rotation")||0,b=d.data("zoom")||1;a+=90;d.removeClass("zoomable").addClass("rotating");d.css("transform","rotate("+a+"deg) scale("+b+")").data("rotation",a).on("transitionend webkitTransitionEnd oTransitionEnd otransitionend",function(){d.addClass("zoomable").removeClass("rotating")})},onScrollZoom:function(a,b,c){if(c)return!1;var e=this;if("video"==J){a=n.data("zoom")||1;a+=b/10;if(.5>a)return!1;n.data("zoom",a).css({width:624*a,height:351*a})}else U(function(){var a=
d.data("zoom")||1,c=d.data("rotation")||0,f=d.data("position")||"50% 50%",k=d[0].getBoundingClientRect();a+=b/10;.1>a&&(a=.1);d.data("zoom",a);a="scale("+a+") rotate("+c+"deg)";k.height>E.clientHeight||k.width>E.clientWidth?(C.on("mousemove.photobox",e.events.callbacks.onMouseMoveimageReposition),a+=" translate("+f+")"):C.off("mousemove.photobox");d.css({transform:a})});return!1},onMouseMoveimageReposition:function(a){U(function(){var b=(a.clientY/E.clientHeight*100-50)/1.5,c=(a.clientX/E.clientWidth*
100-50)/1.5,e=d.data("rotation")||0,f=e/90%4||0,h=d.data("zoom")||1;b=1==f||3==f?b.toFixed(2)+"%, "+-c.toFixed(2)+"%":c.toFixed(2)+"%, "+b.toFixed(2)+"%";d.data("position",b);d[0].style.transform="rotate("+e+"deg) scale("+h+") translate("+b+")"})}}}};var D=function(){var a=0,b=0,f=0,d=0,q=null,h,r,m,g;return{generate:function(){var a=c("<ul>"),b=[],f=this.imageLinks.length,e,d;for(d=0;d<f;d++){var k=this.imageLinks[d];if(e=this.images[d][2]){var q=this.images[d][1];var h=k.rel?" class='"+k.rel+"'":
"";b.push("<li"+h+'><a href="'+k.href+'"><img src="'+e+'" alt="" title="'+q+'" /></a></li>')}}a.html(b.join(""));return a},click:function(a){a.preventDefault();B.removeClass("active");B=c(this).parent().addClass("active");a=c(this.parentNode).index();return G(a,0,1)},changeActiveTimeout:null,changeActive:function(a,b,c){e.thumbs&&(B.index(),B.removeClass("active"),B=l.find("li").eq(a).addClass("active"),!c&&B[0]&&(clearTimeout(this.changeActiveTimeout),this.changeActiveTimeout=setTimeout(function(){var a=
B[0].offsetLeft+B[0].clientWidth/2-E.clientWidth/2;b?l.delay(800):l.stop();l.animate({scrollLeft:a},500,"swing")},200)))},calc:function(c){r=l[0];a=r.clientWidth;b=r.scrollWidth;h=.15*a;f=l.offset().left;d=c.pageX-h-f;g=d/(a-2*h);m=(b-a)*g;l.animate({scrollLeft:m},200);clearTimeout(q);q=setTimeout(function(){q=null},200);return this},move:function(c){if(!q){c=c.pageX-h-f;0>c&&(c=0);var e=c/(a-2*h)*(b-a);U(function(){r.scrollLeft=e})}}}}();var g={autoPlayTimer:!1,play:function(){g.autoPlayTimer=setTimeout(function(){G(w)},
e.time);g.progress.start();u.removeClass("play");g.setTitle("Click to stop autoplay");e.autoplay=!0},pause:function(){clearTimeout(g.autoPlayTimer);g.progress.reset();u.addClass("play");g.setTitle("Click to resume autoplay");e.autoplay=!1},progress:{reset:function(){u.find("div").removeAttr("style");setTimeout(function(){u.removeClass("playing")},200)},start:function(){v||u.find("div").css(ua,e.time+"ms");u.addClass("playing")}},setTitle:function(a){a&&u.prop("title",a+" (every "+e.time/1E3+" seconds)")},
toggle:function(a){a.stopPropagation();g[e.autoplay?"pause":"play"]()}};var G=function(){var a;return function(b,c,l){if(!a){a=setTimeout(function(){a=null},150);C.off("mousemove.photobox");if(!b||0>b)b=0;e.loop||(ia.toggleClass("pbHide",b==m.length-1),ha.toggleClass("pbHide",0==b));"function"==typeof e.beforeShow&&e.beforeShow(F[b]);f.removeClass("error");0<=h&&f.addClass(b>h?"next":"prev");pa(b);da();n.empty();x.onerror=null;d.add(n).data("zoom",1);J="video"==F[b].rel?"video":"image";if("video"==
J)n.html(qa()).addClass("pbHide"),ba(c);else{var q=setTimeout(function(){f.addClass("pbLoading")},50);v&&f.addClass("pbHide");e.autoplay&&g.progress.reset();x=new Image;x.onload=function(){x.onload=null;0<=z&&(ea.src=m[z][0]);0<=w&&(fa.src=m[w][0]);clearTimeout(q);ba(c)};x.onerror=ra;x.src=A}M.on("transitionend webkitTransitionEnd oTransitionEnd otransitionend",aa).addClass("change");(c||v)&&aa();D.changeActive(b,c,l);O.save()}}}();var O={save:function(){"pushState"in window.history&&decodeURIComponent(window.location.hash.slice(1))!=
A&&e.history&&window.history.pushState("photobox",y.title+"-"+m[h][1],window.location.pathname+window.location.search+"#"+encodeURIComponent(A))},load:function(){if(e&&!e.history)return!1;var a=decodeURIComponent(window.location.hash.slice(1));!a&&f.hasClass("show")&&H();c('a[href="'+a+'"]').trigger("click.photobox")},clear:function(){e.history&&"pushState"in window.history&&window.history.pushState("photobox",y.title,window.location.pathname+window.location.search)}};window.onpopstate=function(){var a=
window.onpopstate;return function(b){a&&a.apply(this,arguments);"photobox"==b.state&&O.load()}}();c.event.special.swipe={setup:function(){c(this).bind("touchstart",c.event.special.swipe.handler)},teardown:function(){c(this).unbind("touchstart",c.event.special.swipe.handler)},handler:function(a){function b(){m.removeEventListener("touchmove",e);g=l=null}function e(e){e.preventDefault();var d=g-e.touches[0].pageX;e=l-e.touches[0].pageY;20<=Math.abs(d)?(b(),h=0<d?-1:1):20<=Math.abs(e)&&(b(),r=0<e?1:
-1);a.type="swipe";f.unshift(a,h,r);return(c.event.dispatch||c.event.handle).apply(m,f)}var f=[].slice.call(arguments,1),d=a.originalEvent.touches,h=0,r=0,m=this;a=c.event.fix(a);if(1==d.length){var g=d[0].pageX;var l=d[0].pageY;this.addEventListener("touchmove",e,!1)}}};!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof exports?module.exports=a:a(jQuery)}(function(a){function b(b){var d=b||window.event,h=m.call(arguments,1),k,g=0,p=0,K=0,q=0,r=0;if(b=a.event.fix(d),
b.type="mousewheel","detail"in d&&(p=-1*d.detail),"wheelDelta"in d&&(p=d.wheelDelta),"wheelDeltaY"in d&&(p=d.wheelDeltaY),"wheelDeltaX"in d&&(g=-1*d.wheelDeltaX),"axis"in d&&d.axis===d.HORIZONTAL_AXIS&&(g=-1*p,p=0),k=0===p?g:p,"deltaY"in d&&(p=-1*d.deltaY,k=p),"deltaX"in d&&(g=d.deltaX,0===p&&(k=-1*g)),0!==p||0!==g){if(1===d.deltaMode){var n=a.data(this,"mousewheel-line-height");k*=n;p*=n;g*=n}else 2===d.deltaMode&&(n=a.data(this,"mousewheel-page-height"),k*=n,p*=n,g*=n);if(K=Math.max(Math.abs(p),
Math.abs(g)),(!f||f>K)&&(f=K,l.settings.adjustOldDeltas&&"mousewheel"===d.type&&0===K%120&&(f/=40)),l.settings.adjustOldDeltas&&"mousewheel"===d.type&&0===K%120&&(k/=40,g/=40,p/=40),k=Math[1<=k?"floor":"ceil"](k/f),g=Math[1<=g?"floor":"ceil"](g/f),p=Math[1<=p?"floor":"ceil"](p/f),l.settings.normalizeOffset&&this.getBoundingClientRect)d=this.getBoundingClientRect(),q=b.clientX-d.left,r=b.clientY-d.top;return b.deltaX=g,b.deltaY=p,b.deltaFactor=f,b.offsetX=q,b.offsetY=r,b.deltaMode=0,h.unshift(b,k,
g,p),e&&clearTimeout(e),e=setTimeout(c,200),(a.event.dispatch||a.event.handle).apply(this,h)}}function c(){f=null}var e,f,d=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],h="onwheel"in document||9<=document.documentMode?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],m=Array.prototype.slice;if(a.event.fixHooks)for(var g=d.length;g;)a.event.fixHooks[d[--g]]=a.event.mouseHooks;var l=a.event.special.mousewheel={version:"3.1.11",setup:function(){if(this.addEventListener)for(var c=
h.length;c;)this.addEventListener(h[--c],b,!1);else this.onmousewheel=b;a.data(this,"mousewheel-line-height",l.getLineHeight(this));a.data(this,"mousewheel-page-height",l.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var c=h.length;c;)this.removeEventListener(h[--c],b,!1);else this.onmousewheel=null;a.removeData(this,"mousewheel-line-height");a.removeData(this,"mousewheel-page-height")},getLineHeight:function(b){b=a(b)["offsetParent"in a.fn?"offsetParent":"parent"]();return b.length||
(b=a("body")),parseInt(b.css("fontSize"),10)},getPageHeight:function(b){return a(b).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};a.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})});window._photobox={DOM:{overlay:f},close:H,history:O,defaults:ja}})(jQuery,document,window);